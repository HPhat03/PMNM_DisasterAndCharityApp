{% extends "admin/base.html" %}

{% block extrahead %}
{{ block.super }}
<link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet"/>

<!-- Thêm Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
{% endblock %}

{% block content %}
    <style>
        body {
            background-color: #f9f9f9;
            font-family: Arial, sans-serif;
        }
        .form-container {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: auto;
        }
        h1 {
            color: #333;
        }
        label {
            font-weight: bold;
            color: #555;
        }
        input, textarea {
            border-radius: 5px;
        }
        .btn-submit {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
        }
        .btn-submit:hover {
            background-color: #0056b3;
        }
        #map {
          height: 650px;
          width: 100%;
        }
        button {
          margin: 10px;
          padding: 10px 20px;
          font-size: 16px;
          cursor: pointer;
        }
    </style>
<h1>Kênh liên lạc khẩn cấp:</h1>

<!-- Nút thay đổi vị trí -->

<button id="changeLocationBtn">Change Location</button> <br/>

<div id="map"></div>
    <div class="container mt-5">
        <div class="form-container">
            <h1 class="text-center mb-4">Help Request Form</h1>
            <form method="POST">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="latitude" class="form-label">Latitude</label>
                    <input type="number" step="0.000001" class="form-control" id="latitude" name="latitude" placeholder="Enter latitude" required>
                </div>
                <div class="mb-3">
                    <label for="longitude" class="form-label">Longitude</label>
                    <input type="number" step="0.000001" class="form-control" id="longitude" name="longitude" placeholder="Enter longitude" required>
                </div>
                <div class="mb-3">
                    <label for="victim_name" class="form-label">Victim Name</label>
                    <input type="text" class="form-control" id="victim_name" name="victim_name" placeholder="Enter victim's name" maxlength="50" required>
                </div>
                <div class="mb-3">
                    <label for="victim_problem" class="form-label">Victim Problem</label>
                    <input type="text" class="form-control" id="victim_problem" name="victim_problem" placeholder="Describe the problem" maxlength="100" required>
                </div>
                <div class="mb-3">
                    <label for="victim_solution" class="form-label">Proposed Solution</label>
                    <textarea class="form-control" id="victim_solution" name="victim_solution" rows="3" placeholder="Suggest a solution"></textarea>
                </div>
                <div class="mb-3">
                    <label for="victim_place" class="form-label">Victim Place</label>
                    <input type="text" class="form-control" id="victim_place" name="victim_place" placeholder="Enter location" maxlength="225" required>
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-submit">Submit Request</button>
                </div>
            </form>
        </div>
    </div>
<script>
    var map = L.map('map').setView([{{help_request.latitude}}, {{help_request.longitude}}], 13);  // Vị trí và zoom ban đầu

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var marker = L.marker([{{help_request.latitude}}, {{help_request.longitude}}]).addTo(map)
      .bindPopup("Yêu cầu cứu trợ")
      .openPopup();

    document.getElementById('changeLocationBtn').onclick = function() {
      var newLat = 48.8566; // Vĩ độ mới
      var newLon = 2.3522;  // Kinh độ mới (Paris, Pháp)

      marker.setLatLng([newLat, newLon])
        .bindPopup("New location: Paris")
        .openPopup();

      map.setView([newLat, newLon], 13);
    };
</script>
{% endblock %}